<!DOCTYPE html>
<html lang="zh-TW" style="background-color: #f7f6f6;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
    <title>麻將日誌 - 2026</title>
    <!-- 引入外部資源 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&display=swap');
        
        :root {
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        [v-cloak] { display: none !important; }

        body {
            font-family: 'Noto Serif TC', serif;
            overscroll-behavior-y: none;
            -webkit-tap-highlight-color: transparent;
            background-color: #f7f6f6;
            color: #302b28;
            margin: 0;
        }

        .ios-pwa-container {
            min-height: 100vh;
            min-height: -webkit-fill-available;
        }

        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .active-scale:active { transform: scale(0.95); transition: transform 0.1s; }
        
        @media (min-width: 768px) {
            .active-scale:hover { transform: scale(1.01); transition: transform 0.2s; }
        }

        .category-chip {
            padding: 2px 8px;
            border-radius: 99px;
            font-size: 10px;
            font-weight: 900;
            transition: all 0.2s;
            border-width: 1px;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body>
    <div id="app" class="ios-pwa-container overflow-x-hidden" v-cloak>
        <div class="h-[env(safe-area-inset-top)] w-full bg-[#f7f6f6] sticky top-0 z-50 no-export"></div>

        <div ref="mainContent" class="w-full max-w-6xl mx-auto flex flex-col gap-6 px-3 md:px-10 pb-32">
            
            <!-- Header 標題列 -->
            <div class="pt-8 pb-4 text-center relative">
                <div class="absolute left-0 top-8 flex gap-2 no-export">
                    <button @click="handleManualRefresh" class="p-2 text-[#999] active-scale">
                        <i data-lucide="rotate-cw" :class="{'animate-spin text-[#1893f8]': cloudStatus === 'syncing'}" class="w-5 h-5"></i>
                    </button>
                </div>
                <div class="absolute right-0 top-8 flex gap-2 no-export">
                    <button @click="handleQuickAdd" class="p-2 text-[#999] active-scale">
                        <i data-lucide="plus" class="w-6 h-6"></i>
                    </button>
                </div>
                <h1 class="text-4xl font-black text-[#201f1f] tracking-widest mb-2">麻將日誌</h1>
                <div class="h-0.5 w-16 bg-[#1893f8]/40 mx-auto rounded-full mb-4"></div>
                
                <div class="flex justify-center no-export">
                    <div class="inline-flex items-center gap-2 mb-3 px-1 py-0.5 text-[10px] font-bold tracking-widest uppercase text-[#999]">
                        <div v-if="cloudStatus === 'connected'" class="w-2 h-2 bg-emerald-500 rounded-full"></div>
                        <div v-else-if="cloudStatus === 'disconnected'" class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                        <i v-else-if="cloudStatus === 'syncing'" data-lucide="refresh-cw" class="w-3 h-3 animate-spin text-[#1893f8]"></i>
                        {{ cloudStatusText }}
                    </div>
                </div>

                <div v-if="activeTab === 'home'" class="mt-4 no-export max-w-[280px] mx-auto w-full px-1">
                    <div class="relative">
                        <select v-model="monthFilter" class="w-full appearance-none bg-white border border-[#eee] rounded-full px-8 py-3.5 text-xs font-black text-[#1893f8] shadow-sm focus:outline-none cursor-pointer">
                            <option value="all">2026 全年統計</option>
                            <option v-for="m in 12" :key="m" :value="m">{{ currentYear }} 年 {{ m }} 月</option>
                        </select>
                        <i data-lucide="chevron-down" class="text-[#1893f8] absolute right-6 top-1/2 -translate-y-1/2 pointer-events-none w-4 h-4"></i>
                    </div>
                </div>
            </div>

            <main class="flex-1">
                <!-- Tab 1: 首頁看板 -->
                <div v-if="activeTab === 'home'" class="flex flex-col gap-6 animate-in fade-in duration-500">
                    <div class="bg-[#1893f8] p-8 rounded-[3rem] text-white shadow-xl relative overflow-hidden max-w-4xl mx-auto w-full transition-all">
                        <div class="relative z-10 text-center">
                            <div class="flex items-center justify-center gap-2 mb-6">
                                <i data-lucide="trophy" class="w-5 h-5 text-white/80"></i>
                                <h2 class="text-xl font-black tracking-widest uppercase">
                                    {{ currentYear }} {{ monthFilter === 'all' ? 'Balance' : monthFilter + '月 表現' }}
                                </h2>
                            </div>
                            <div class="grid grid-cols-2 gap-8 relative">
                                <div class="absolute left-1/2 top-0 bottom-0 w-[1px] bg-white/20 -translate-x-1/2"></div>
                                <div class="relative">
                                    <div class="text-[10px] font-black uppercase opacity-80 mb-1">Family</div>
                                    <div class="text-3xl md:text-4xl font-black tracking-tighter" :class="stats.familyProfit < 0 ? 'text-[#ff4d4d]' : 'text-white'">
                                        {{ stats.familyProfit >= 0 ? '+' : '' }}{{ stats.familyProfit.toLocaleString() }}
                                    </div>
                                </div>
                                <div class="relative">
                                    <div class="text-[10px] font-black uppercase opacity-80 mb-1">Couple</div>
                                    <div class="text-3xl md:text-4xl font-black tracking-tighter" :class="stats.coupleProfit < 0 ? 'text-[#ff4d4d]' : 'text-white'">
                                        {{ stats.coupleProfit >= 0 ? '+' : '' }}{{ stats.coupleProfit.toLocaleString() }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-if="homeFilteredPlayers.length > 0" class="grid grid-cols-2 gap-4 md:gap-8 mt-2 max-w-4xl mx-auto w-full">
                        <div v-for="player in homeFilteredPlayers" :key="player.name" 
                             class="bg-white p-5 md:p-8 rounded-[2.5rem] shadow-sm border border-[#eee] flex flex-col active-scale group hover:shadow-lg transition-all duration-300">
                            <div class="flex items-center justify-start gap-2 mb-4">
                                <div class="w-8 h-8 md:w-10 md:h-10 flex-shrink-0 bg-[#f7f6f6] rounded-full flex items-center justify-center text-[#302b28] group-hover:bg-[#1893f8] group-hover:text-white transition-colors">
                                    <i data-lucide="user" class="w-4 h-4 md:w-5 md:h-5"></i>
                                </div>
                                <div class="font-black text-[#302b28] text-base md:text-lg truncate">{{ player.name }}</div>
                            </div>
                            
                            <div class="mt-1 mb-6 flex flex-col items-center">
                                <div class="text-[10px] md:text-xs font-black text-[#999] bg-[#f7f6f6] px-2 py-0.5 rounded shadow-sm border border-[#eee] mb-2 leading-none uppercase tracking-widest">年度盈虧</div>
                                <span class="text-3xl md:text-5xl font-black tracking-tighter" :class="getAnnualProfit(player.name) >= 0 ? 'text-[#1893f8]' : 'text-[#ff4d4d]'">
                                    {{ getAnnualProfit(player.name) >= 0 ? '+' : '' }}{{ getAnnualProfit(player.name).toLocaleString() }}
                                </span>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-1 pt-4 md:pt-6 border-t border-[#f7f6f6]">
                                <div class="text-center">
                                    <div class="text-[8px] md:text-[10px] font-black text-[#999] uppercase mb-0.5">贏錢</div>
                                    <div class="text-xs md:text-sm font-black text-[#1893f8]">+{{ getAnnualWinnings(player.name).toLocaleString() }}</div>
                                </div>
                                <div class="text-center border-l border-[#f7f6f6]">
                                    <div class="text-[8px] md:text-[10px] font-black text-[#999] uppercase mb-0.5">輸錢</div>
                                    <div class="text-xs md:text-sm font-black text-[#ff4d4d]">{{ getAnnualLosses(player.name).toLocaleString() }}</div>
                                </div>
                            </div>
                            
                            <div class="mt-6 md:mt-8 flex flex-col sm:flex-row items-center justify-between gap-3">
                                <div class="text-[9px] md:text-[11px] font-bold text-[#999] bg-[#f7f6f6] py-2 md:py-3 rounded-2xl border border-[#eee] truncate w-full sm:flex-1 text-center px-1">
                                    {{ getPartCount(player.name) }}場 / {{ getTotalRounds(player.name) }}將
                                </div>
                                <button @click="detailPlayer = player.name" class="w-full sm:flex-1 py-2 md:py-3 bg-[#1893f8] text-white text-[10px] md:text-xs font-black uppercase rounded-2xl shadow-md active-scale no-export flex items-center justify-center gap-2">
                                    <i data-lucide="info" class="w-3 h-3 md:w-4 md:h-4"></i>明細
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab 2: 日曆紀錄 (預設) -->
                <div v-if="activeTab === 'calendar'" class="flex flex-col gap-6 animate-in fade-in duration-500 max-w-5xl mx-auto">
                    <div class="bg-white rounded-[3rem] p-2 md:p-10 border border-[#eee] shadow-sm">
                        <div class="flex items-center justify-between px-4 py-4 mb-6">
                            <button @click="prevMonth" class="w-12 h-12 flex items-center justify-center rounded-full bg-white text-[#1893f8] border border-[#eee] active-scale shadow-sm"><i data-lucide="chevron-left" class="w-6 h-6"></i></button>
                            <div class="flex flex-col items-center">
                                <span class="text-2xl font-black text-[#1893f8] tracking-widest">{{ currentYear }}</span>
                                <div class="text-xl font-bold text-[#201f1f] mt-1">{{ currentMonth + 1 }}月 紀錄表</div>
                            </div>
                            <button @click="nextMonth" class="w-12 h-12 flex items-center justify-center rounded-full bg-white text-[#1893f8] border border-[#eee] active-scale shadow-sm"><i data-lucide="chevron-right" class="w-6 h-6"></i></button>
                        </div>
                        
                        <div class="grid grid-cols-7 gap-1 mb-4">
                            <div v-for="d in ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT']" :key="d" class="text-center text-[10px] md:text-xs font-black tracking-widest text-[#1893f8] opacity-50">{{ d }}</div>
                        </div>
                        
                        <div class="grid grid-cols-7 gap-1 md:gap-3 mb-4">
                            <div v-for="empty in firstDayOfMonth" :key="'e-'+empty" class="min-h-[80px]"></div>
                            <button v-for="day in daysInMonth" :key="day" @click="handleDateClick(day)"
                                class="min-h-[120px] md:min-h-[160px] h-auto rounded-2xl md:rounded-[2rem] flex flex-col items-center py-3 transition-all relative active-scale bg-white border"
                                :class="records[formatDateKey(currentYear, currentMonth + 1, day)] ? 'border-2 border-[#1893f8] shadow-md z-10' : 'border-[#eee]'">
                                <span class="text-sm md:text-lg font-black mb-2" :class="records[formatDateKey(currentYear, currentMonth + 1, day)] ? 'text-[#1893f8]' : 'text-[#999]'">{{ day }}</span>
                                
                                <div v-if="records[formatDateKey(currentYear, currentMonth + 1, day)]" class="flex flex-col w-full px-1 gap-1.5 mt-1">
                                    <div v-for="(val, name) in getCoupleStatsForDay(formatDateKey(currentYear, currentMonth + 1, day))" :key="name" 
                                        class="text-[12px] md:text-[15px] font-black flex flex-col items-center justify-center px-1 py-2 rounded-xl leading-none shadow-sm transition-all"
                                        :class="val > 0 ? 'bg-[#1893f8]/10 text-[#1893f8]' : val < 0 ? 'bg-[#ff4d4d]/10 text-[#ff4d4d]' : 'bg-gray-100 text-gray-500'">
                                        <span class="truncate w-full text-center mb-1 opacity-70 leading-tight">{{ name }}</span>
                                        <span class="font-mono truncate w-full text-center font-black leading-tight">{{ val > 0 ? '+' : '' }}{{ val }}</span>
                                    </div>
                                </div>
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 px-1 no-export max-w-md mx-auto w-full">
                        <button @click="downloadImage" class="flex items-center justify-center gap-2 py-5 bg-white border border-[#eee] rounded-[2rem] text-sm font-black shadow-sm active-scale"><i data-lucide="download" class="text-[#1893f8] w-5 h-5"></i> 截圖保存</button>
                        <button @click="isMonthDetailOpen = true" class="flex items-center justify-center gap-2 py-5 bg-white border border-[#eee] rounded-[2rem] text-sm font-black shadow-sm active-scale"><i data-lucide="file-text" class="text-[#1893f8] w-5 h-5"></i> 當月明細</button>
                    </div>

                    <div class="bg-white rounded-[3rem] p-8 shadow-sm border border-[#eee] mt-4 space-y-8">
                        <div class="flex items-center justify-center gap-2 border-b border-[#f7f6f6] pb-5">
                            <i data-lucide="award" class="w-6 h-6 text-[#1893f8]"></i>
                            <h3 class="text-lg font-black text-[#302b28]">{{ currentMonth + 1 }}月 表現總覽</h3>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div class="space-y-3">
                                <div class="text-[11px] font-black text-[#999] uppercase text-center mb-4 tracking-widest">個人月盈虧</div>
                                <div v-for="p in filteredMonthlyStats" :key="p.name" 
                                    class="flex justify-between items-center bg-[#f7f6f6] px-5 py-3 rounded-2xl text-sm font-bold">
                                    <span class="text-[#302b28]">{{ p.name }}</span>
                                    <span :class="p.totalProfit >= 0 ? 'text-[#1893f8]' : 'text-[#ff4d4d]'">
                                        {{ p.totalProfit > 0 ? '+' : '' }}{{ p.totalProfit.toLocaleString() }}
                                    </span>
                                </div>
                            </div>
                            <div class="space-y-3 md:border-l md:border-[#f7f6f6] md:pl-8">
                                <div class="text-[11px] font-black text-[#999] uppercase text-center mb-4 tracking-widest">英雄榜 (勝率)</div>
                                <div v-for="(p, idx) in stats.calLeaderboard" :key="p.name" 
                                    class="flex items-center gap-4 bg-[#f7f6f6] px-5 py-3 rounded-2xl text-sm font-bold">
                                    <span class="w-6 h-6 flex items-center justify-center rounded-full text-xs" :class="idx === 0 ? 'bg-yellow-400 text-white shadow-sm' : 'bg-white text-[#999]'">{{ idx + 1 }}</span>
                                    <span class="flex-1 truncate">{{ p.name }}</span>
                                    <span :class="p.totalProfit >= 0 ? 'text-[#1893f8]' : 'text-[#ff4d4d]'">{{ p.totalProfit.toLocaleString() }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab 3: 年度排行 (改回單欄垂直排序) -->
                <div v-if="activeTab === 'leaderboard'" class="flex flex-col gap-6 animate-in fade-in duration-500 max-w-4xl mx-auto w-full transition-all">
                    <div class="bg-white rounded-[3rem] shadow-sm border border-[#eee] p-8 md:p-12">
                        <div class="flex items-center justify-center gap-3 mb-10 border-b border-[#f7f6f6] pb-8">
                            <i data-lucide="award" class="w-8 h-8 text-[#1893f8]"></i>
                            <h3 class="text-2xl font-black text-[#302b28]">{{ currentYear }} 年度英雄榜</h3>
                        </div>
                        
                        <!-- 垂直單欄列表 -->
                        <div class="flex flex-col gap-6">
                            <div v-for="(item, idx) in leaderboard" :key="item.name" class="flex flex-col p-8 rounded-[3rem] bg-[#f7f6f6]/50 border border-transparent hover:bg-white hover:border-[#eee] hover:shadow-xl transition-all duration-300">
                                <div class="flex flex-col sm:flex-row items-center justify-between gap-4 mb-6">
                                    <div class="flex items-center gap-4 overflow-hidden">
                                        <span class="text-base font-black italic w-10 h-10 rounded-full flex items-center justify-center shrink-0 shadow-sm" :class="idx === 0 ? 'bg-yellow-400 text-white' : 'bg-white text-[#999]'">{{ idx + 1 }}</span>
                                        <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-[#302b28] shadow-sm shrink-0"><i data-lucide="user" class="w-5 h-5"></i></div>
                                        <span class="font-black text-[#302b28] text-xl truncate">{{ item.name }}</span>
                                    </div>
                                    <div class="relative">
                                        <span class="text-4xl font-black tracking-tighter" :class="item.totalProfit >= 0 ? 'text-[#1893f8]' : 'text-[#ff4d4d]'">
                                            {{ item.totalProfit > 0 ? '+' : '' }}{{ item.totalProfit.toLocaleString() }}
                                        </span>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-4 mt-2 mb-6 bg-white/60 p-5 rounded-3xl text-center shadow-inner">
                                    <div><div class="text-[10px] font-black text-[#999] uppercase mb-1">年度盈利</div><div class="text-xl font-black text-[#1893f8]">+{{ item.totalWinnings.toLocaleString() }}</div></div>
                                    <div class="border-l border-[#eee]"><div class="text-[10px] font-black text-[#999] uppercase mb-1">年度赤字</div><div class="text-xl font-black text-[#ff4d4d]">{{ item.totalLosses.toLocaleString() }}</div></div>
                                </div>
                                <div class="grid grid-cols-3 gap-2 py-4 border-t border-white/60 items-center">
                                    <div class="flex flex-col items-center"><span class="text-sm font-black text-[#302b28]">{{ item.participateCount }}場 / {{ item.totalRounds }}將</span><span class="text-[8px] text-[#999] font-black uppercase tracking-widest">紀錄</span></div>
                                    <div class="flex flex-col items-center border-x border-[#eee]"><span class="text-sm font-black text-emerald-500">{{ item.winRate }}%</span><span class="text-[8px] text-[#999] font-black uppercase tracking-widest">勝率</span></div>
                                    <button @click="detailPlayer = item.name" class="text-xs font-black text-[#1893f8] active-scale tracking-widest uppercase hover:underline">詳情紀錄</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- 底部導覽列 -->
        <div class="fixed bottom-0 left-0 right-0 z-40 bg-gradient-to-t from-[#f7f6f6] via-[#f7f6f6] to-transparent pt-4 pb-[env(safe-area-inset-bottom)] no-export">
            <div class="max-w-[320px] md:max-w-[400px] mx-auto mb-8 px-4">
                <div class="bg-white/90 backdrop-blur-2xl p-1.5 rounded-[2.5rem] border border-[#eee] shadow-2xl flex items-center gap-1.5">
                    <button @click="activeTab = 'home'" class="flex-1 flex items-center justify-center gap-2 py-3 rounded-[2rem] text-sm font-bold transition-all" :class="activeTab === 'home' ? 'bg-[#e55039] text-white shadow-lg' : 'text-[#999] hover:bg-[#f7f6f6]'">
                        <i data-lucide="home" class="w-5 h-5"></i><span class="hidden sm:inline">首頁</span>
                    </button>
                    <button @click="activeTab = 'calendar'" class="flex-1 flex items-center justify-center gap-2 py-3 rounded-[2rem] text-sm font-bold transition-all" :class="activeTab === 'calendar' ? 'bg-[#1893f8] text-white shadow-lg' : 'text-[#999] hover:bg-[#f7f6f6]'">
                        <i data-lucide="calendar" class="w-5 h-5"></i><span class="hidden sm:inline">日曆</span>
                    </button>
                    <button @click="activeTab = 'leaderboard'" class="flex-1 flex items-center justify-center gap-2 py-3 rounded-[2rem] text-sm font-bold transition-all" :class="activeTab === 'leaderboard' ? 'bg-[#1893f8] text-white shadow-lg' : 'text-[#999] hover:bg-[#f7f6f6]'">
                        <i data-lucide="list-ordered" class="w-5 h-5"></i><span class="hidden sm:inline">排行</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 錄入戰報 Modal -->
        <transition name="fade">
            <div v-if="isModalOpen" class="fixed inset-0 bg-[#302b28]/70 backdrop-blur-md flex items-end sm:items-center justify-center z-50 p-0 sm:p-4">
                <div class="bg-white rounded-t-[3rem] sm:rounded-[3rem] w-full max-w-3xl max-h-[92vh] overflow-y-auto shadow-2xl p-6 sm:p-10 pb-[calc(2rem+env(safe-area-inset-bottom))] relative">
                    <div class="flex justify-between items-start mb-8 pb-5 border-b border-[#f7f6f6]">
                        <div>
                            <h3 class="text-2xl font-black text-[#1893f8]">{{ viewMode === 'edit' ? '錄入戰報' : '戰況紀錄' }}</h3>
                            <input v-if="viewMode === 'edit'" type="date" v-model="selectedDate" class="mt-3 text-base font-black bg-[#f7f6f6] px-4 py-2 rounded-xl border-none focus:ring-2 ring-[#1893f8]">
                            <p v-else class="text-xs font-bold text-[#999] uppercase font-mono mt-2 tracking-widest">{{ selectedDate }}</p>
                        </div>
                        <div class="flex items-center gap-4">
                            <div class="flex bg-[#f7f6f6] p-1 rounded-2xl">
                                <button @click="viewMode = 'preview'" class="px-5 py-2 rounded-xl text-xs font-bold transition-all" :class="viewMode === 'preview' ? 'bg-[#1893f8] text-white shadow-md' : 'text-[#999]'">預覽</button>
                                <button @click="handleEditTabClick" class="px-5 py-2 rounded-xl text-xs font-bold transition-all" :class="viewMode === 'edit' ? 'bg-[#1893f8] text-white shadow-md' : 'text-[#999]'">編輯</button>
                            </div>
                            <button @click="isModalOpen = false" class="w-12 h-12 flex items-center justify-center rounded-full bg-[#f7f6f6] text-[#999] active-scale shadow-inner">
                                <i data-lucide="x" class="w-6 h-6"></i>
                            </button>
                        </div>
                    </div>

                    <div v-if="viewMode === 'edit'" class="space-y-8">
                        <div v-if="!isVerified" class="py-16 flex flex-col items-center justify-center text-center">
                            <div class="w-20 h-20 bg-[#f7f6f6] rounded-full flex items-center justify-center text-[#1893f8] mb-6 shadow-inner">
                                <i data-lucide="lock" class="w-10 h-10"></i>
                            </div>
                            <h4 class="font-black text-xl mb-3">權限驗證</h4>
                            <p class="text-sm text-[#999] mb-8 uppercase tracking-widest">請輸入 PIN CODE 以進行編輯</p>
                            <div class="w-full max-w-[240px]">
                                <input type="password" v-model="passwordInput" placeholder="••••" class="w-full bg-[#f7f6f6] rounded-[2rem] px-6 py-5 text-center text-2xl font-black border-none focus:ring-4 ring-[#1893f8]/20 mb-5" @keyup.enter="checkPassword">
                                <button @click="checkPassword" class="w-full py-5 bg-[#1893f8] text-white rounded-[2rem] font-black shadow-xl active-scale">確認進入</button>
                                <p v-if="passwordError" class="text-xs text-[#ff4d4d] mt-4 font-bold">密碼錯誤，請檢查後再試</p>
                            </div>
                        </div>

                        <div v-else class="space-y-8">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="md:col-span-1">
                                    <label class="text-[11px] font-black text-[#999] block mb-3 uppercase tracking-widest">籌碼規格</label>
                                    <select v-model="formData.stakes" class="w-full bg-[#f7f6f6] rounded-2xl px-5 py-4 text-sm font-bold border-none focus:ring-2 ring-[#1893f8]">
                                        <option value="30/10">30 / 10</option>
                                        <option value="50/20">50 / 20</option>
                                        <option value="100/20">100 / 20</option>
                                    </select>
                                </div>
                                <div class="md:col-span-1">
                                    <label class="text-[11px] font-black text-[#999] block uppercase mb-3 tracking-widest">打幾將</label>
                                    <input type="number" step="0.5" v-model="formData.rounds" class="w-full bg-[#f7f6f6] rounded-2xl px-5 py-4 text-sm font-bold border-none focus:ring-2 ring-[#1893f8]">
                                </div>
                                <div class="md:col-span-1">
                                    <label class="text-[11px] font-black text-[#999] block uppercase mb-3 tracking-widest">戰鬥地點</label>
                                    <input type="text" v-model="formData.location" placeholder="例如：新家、基地..." class="w-full bg-[#f7f6f6] rounded-2xl px-5 py-4 text-sm font-bold border-none focus:ring-2 ring-[#1893f8]">
                                </div>
                            </div>
                            
                            <div class="bg-[#f7f6f6] p-6 md:p-10 rounded-[3rem] border border-[#eee]">
                                <label class="text-[11px] font-black text-[#999] block mb-4 uppercase tracking-widest">參與玩家管理</label>
                                <div class="flex gap-3 mb-6">
                                    <input type="text" placeholder="輸入姓名" class="w-32 md:w-40 flex-shrink-0 bg-white rounded-2xl px-4 py-3 text-sm font-bold border-none focus:ring-2 ring-[#1893f8]" v-model="newPlayerName" @keypress.enter="addPlayer">
                                    <div class="flex-1 flex gap-2 overflow-x-auto no-scrollbar py-1">
                                        <button v-for="cat in categoryOptions" :key="cat.value" @click="toggleNewPlayerCategory(cat.value)" class="category-chip shrink-0 py-2" :class="newPlayerCategories.includes(cat.value) ? 'bg-[#1893f8] text-white border-[#1893f8]' : 'bg-white text-[#999] border-[#eee]'">{{ cat.label }}</button>
                                    </div>
                                    <button @click="addPlayer" class="bg-[#1893f8] text-white p-3 rounded-2xl active-scale shadow-lg"><i data-lucide="plus" class="w-6 h-6"></i></button>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div v-for="(val, pName) in formData.playerStats" :key="pName" class="flex flex-col bg-white p-4 rounded-[2rem] shadow-sm border border-white hover:border-[#eee] transition-all">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex-1 flex flex-col gap-1 overflow-hidden">
                                                <div class="flex items-center gap-2">
                                                    <button @click="removePlayerFromRecord(pName)" class="text-[#ccc] hover:text-[#e55039] transition-colors"><i data-lucide="x" class="w-4 h-4"></i></button>
                                                    <span class="text-base font-black truncate">{{ pName }}</span>
                                                </div>
                                                <div class="flex gap-1 overflow-x-auto no-scrollbar">
                                                    <button v-for="cat in categoryOptions" :key="cat.value" @click="updatePlayerCategory(pName, cat.value)" class="category-chip shrink-0 py-1" :class="getPlayerCategories(pName).includes(cat.value) ? 'bg-[#201f1f] text-white border-[#201f1f]' : 'bg-[#f7f6f6] text-[#ccc] border-transparent'">{{ cat.label }}</button>
                                                </div>
                                            </div>
                                            <div class="flex bg-[#f7f6f6] rounded-[1.2rem] p-1.5 h-fit shrink-0 shadow-inner">
                                                <button @click="toggleWinLoss(pName, 'win')" class="px-5 py-2 rounded-xl text-xs font-black transition-all" :class="val > 0 ? 'bg-[#1893f8] text-white shadow-md' : 'text-[#999]'">贏</button>
                                                <button @click="toggleWinLoss(pName, 'loss')" class="px-5 py-2 rounded-xl text-xs font-black transition-all" :class="val < 0 ? 'bg-[#ff4d4d] text-white shadow-md' : 'text-[#999]'">輸</button>
                                            </div>
                                        </div>
                                        <div class="relative bg-[#f7f6f6] rounded-2xl overflow-hidden border-2 border-transparent focus-within:border-[#1893f8]/30 transition-all">
                                            <span class="absolute left-5 top-1/2 -translate-y-1/2 text-sm font-black" :class="val < 0 ? 'text-[#ff4d4d]' : val > 0 ? 'text-[#1893f8]' : 'text-[#999]'">$</span>
                                            <input type="number" :value="Math.abs(val)" @input="updateStat(pName, $event.target.value)" class="w-full bg-transparent border-none px-10 py-4 text-right text-xl font-black focus:outline-none focus:ring-0">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex flex-col sm:flex-row gap-4">
                                <button @click="isModalOpen = false" class="flex-1 py-5 rounded-[2.5rem] font-black bg-[#f7f6f6] text-[#999] hover:bg-[#eee] transition-colors">取消變更</button>
                                <button @click="saveRecord" class="flex-[2] py-5 rounded-[2.5rem] font-black bg-[#1893f8] text-white shadow-xl active-scale flex items-center justify-center gap-2">
                                    <i data-lucide="save" class="w-5 h-5"></i> 儲存今日戰報
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div v-else class="space-y-8">
                        <div v-if="records[selectedDate]" class="space-y-8 animate-in fade-in duration-500">
                             <div class="bg-[#f7f6f6] p-8 rounded-[3rem] grid grid-cols-2 gap-8 shadow-inner">
                                <div><div class="text-[10px] text-[#999] font-black uppercase mb-2 tracking-widest">戰鬥規格</div><div class="text-lg font-bold">{{ records[selectedDate].stakes }} / {{ records[selectedDate].rounds }}將</div></div>
                                <div><div class="text-[10px] text-[#999] font-black uppercase mb-2 tracking-widest">對戰地點</div><div class="text-lg font-bold">{{ records[selectedDate].location || '未標註地點' }}</div></div>
                             </div>
                             <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                <div v-for="(s, n) in records[selectedDate].playerStats" :key="n" class="flex justify-between p-6 bg-white border border-[#eee] rounded-3xl shadow-sm items-center hover:shadow-md transition-shadow">
                                    <span class="text-lg font-bold">{{ n }}</span>
                                    <span class="text-xl font-black" :class="s >= 0 ? 'text-[#1893f8]' : 'text-[#ff4d4d]'">{{ s > 0 ? '+' : '' }}{{ s.toLocaleString() }}</span>
                                </div>
                             </div>
                        </div>
                        <div v-else class="py-24 text-center opacity-30 italic text-lg tracking-widest">今日休戰，暫無紀錄</div>
                        <button @click="isModalOpen = false" class="w-full py-5 rounded-[2.5rem] font-black bg-[#201f1f] text-white shadow-xl active-scale">關閉預覽</button>
                    </div>
                </div>
            </div>
        </transition>

        <transition name="fade">
            <div v-if="detailPlayer" class="fixed inset-0 bg-[#302b28]/80 backdrop-blur-md flex items-center justify-center z-[110] p-4">
                <div class="bg-white rounded-[3.5rem] w-full max-w-2xl shadow-2xl max-h-[85vh] flex flex-col animate-in zoom-in-95 duration-300 overflow-hidden">
                    <div class="p-8 md:p-10 pb-5 flex justify-between items-center border-b border-[#f7f6f6]">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-[#1893f8]/10 rounded-2xl flex items-center justify-center text-[#1893f8]"><i data-lucide="user" class="w-6 h-6"></i></div>
                            <div>
                                <h3 class="text-2xl font-black text-[#201f1f]">{{ detailPlayer }} 戰鬥紀錄</h3>
                                <p class="text-[10px] text-[#999] font-black uppercase mt-1 tracking-widest">{{ monthFilter === 'all' ? '2026 全年度數據' : monthFilter + '月份 篩選數據' }}</p>
                            </div>
                        </div>
                        <button @click="detailPlayer = null" class="w-12 h-12 bg-[#f7f6f6] rounded-full flex items-center justify-center text-[#999] active-scale hover:bg-[#eee] transition-colors"><i data-lucide="x" class="w-6 h-6"></i></button>
                    </div>
                    <div class="flex-1 overflow-y-auto p-6 md:p-10 space-y-4 no-scrollbar">
                        <div v-for="(h, i) in getPlayerHistory(detailPlayer)" :key="i" class="bg-[#f7f6f6]/60 rounded-3xl p-6 border border-transparent hover:border-[#eee] hover:bg-white hover:shadow-md transition-all flex justify-between items-center">
                            <div>
                                <div class="text-sm font-black text-[#302b28] mb-1.5">{{ h.date }}</div>
                                <div class="flex items-center gap-3 text-[11px] text-[#999] font-bold"><i data-lucide="map-pin" class="w-3 h-3"></i> {{ h.location || '戰場不明' }} • {{ h.stakes }}</div>
                            </div>
                            <div class="text-2xl font-black" :class="h.amount >= 0 ? 'text-[#1893f8]' : 'text-[#ff4d4d]'">{{ h.amount > 0 ? '+' : '' }}{{ h.amount.toLocaleString() }}</div>
                        </div>
                        <div v-if="getPlayerHistory(detailPlayer).length === 0" class="py-24 text-center opacity-30 italic text-base">這名玩家尚未留下戰績</div>
                    </div>
                    <div class="p-8 md:p-10 pt-5 bg-[#f7f6f6]">
                        <div class="bg-white p-6 rounded-[2rem] text-center shadow-md border border-white">
                            <div class="text-[10px] text-[#999] font-black uppercase mb-1.5 tracking-widest">累計損益</div>
                            <div class="text-3xl font-black" :class="getFilteredProfit(detailPlayer) >= 0 ? 'text-[#1893f8]' : 'text-[#ff4d4d]'">{{ getFilteredProfit(detailPlayer).toLocaleString() }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </transition>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js';
        import { getFirestore, collection, doc, setDoc, onSnapshot, query } from 'https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyB_Wc8n7-3AZzDCPRv6DLqjRTeyk9xmyzE",
            authDomain: "mahjong-2026-c108b.firebaseapp.com",
            projectId: "mahjong-2026-c108b",
            storageBucket: "mahjong-2026-c108b.firebasestorage.app",
            messagingSenderId: "106415682280",
            appId: "1:106415682280:web:7ee800ae2e789d45eecf5d"
        };

        const { createApp, ref, computed, onMounted, watch } = Vue;

        const app = createApp({
            setup() {
                const DEFAULT_PLAYERS = [
                    { name: '阿如', category: ['couple'] },
                    { name: '萱萱', category: ['family'] },
                    { name: '速配', category: ['other'] },
                    { name: '漢斯', category: ['other'] },
                    { name: '阿祐', category: ['family'] },
                    { name: '阿瑋', category: ['couple'] }
                ];

                const appId = ref(new URLSearchParams(window.location.search).get('id') || 'mahjong-tracker-2026');
                const user = ref(null);
                const activeTab = ref('calendar');
                const monthFilter = ref('all');
                const currentYear = ref(new Date().getFullYear());
                const currentMonth = ref(new Date().getMonth());
                const records = ref({});
                const players = ref(DEFAULT_PLAYERS);

                const isVerified = ref(false);
                const passwordInput = ref('');
                const passwordError = ref(false);

                const newPlayerName = ref('');
                const newPlayerCategories = ref(['other']);
                const categoryOptions = [ { label: '家人', value: 'family' }, { label: '情人', value: 'couple' }, { label: '其他', value: 'other' } ];

                const isModalOpen = ref(false);
                const viewMode = ref('preview');
                const selectedDate = ref('');
                const detailPlayer = ref(null);
                const isMonthDetailOpen = ref(false);
                const cloudStatus = ref('disconnected');

                const formData = ref({ stakes: '30/10', location: '', rounds: '1', playerStats: {} });

                const firebaseApp = initializeApp(firebaseConfig);
                const auth = getAuth(firebaseApp);
                const db = getFirestore(firebaseApp);

                onMounted(async () => {
                    lucide.createIcons();
                    await signInAnonymously(auth);
                    onAuthStateChanged(auth, (u) => {
                        user.value = u;
                        if (u) { cloudStatus.value = 'connected'; fetchData(); }
                    });
                });

                const normalizeDateString = (str) => {
                    if (!str || typeof str !== 'string') return str;
                    const parts = str.split('-');
                    if (parts.length !== 3) return str;
                    return `${parts[0]}-${String(parts[1]).padStart(2, '0')}-${String(parts[2]).padStart(2, '0')}`;
                };

                const formatDateKey = (y, m, d) => `${y}-${String(m).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                const ensureCategoryArray = (cat) => Array.isArray(cat) ? cat : (typeof cat === 'string' ? [cat] : ['other']);

                const fetchData = () => {
                    if (!user.value) return;
                    onSnapshot(collection(db, 'artifacts', appId.value, 'public', 'data', 'records'), (snap) => {
                        const data = {};
                        snap.forEach(d => { data[normalizeDateString(d.id)] = d.data(); });
                        records.value = data;
                    });
                    onSnapshot(doc(db, 'artifacts', appId.value, 'public', 'data', 'players_metadata', 'players_list'), (snap) => {
                        if (snap.exists()) {
                            const list = snap.data().list || [];
                            players.value = list.map(p => ({ ...p, category: ensureCategoryArray(p.category) }));
                        } else {
                            setDoc(doc(db, 'artifacts', appId.value, 'public', 'data', 'players_metadata', 'players_list'), { list: DEFAULT_PLAYERS });
                        }
                    });
                };

                const homeFilteredPlayers = computed(() => players.value.filter(p => {
                    const cats = ensureCategoryArray(p.category);
                    return cats.includes('family') || cats.includes('couple');
                }));

                const stats = computed(() => {
                    let familyProfit = 0, coupleProfit = 0;
                    const calMonthMap = {};
                    players.value.forEach(p => calMonthMap[p.name] = { name: p.name, totalProfit: 0, participateCount: 0 });

                    Object.entries(records.value).forEach(([date, rec]) => {
                        const parts = date.split('-');
                        const rYear = parseInt(parts[0]), rMonth = parseInt(parts[1]);
                        if (monthFilter.value === 'all' || rMonth === parseInt(monthFilter.value)) {
                            Object.entries(rec.playerStats).forEach(([name, amount]) => {
                                const p = players.value.find(pl => pl.name === name);
                                const cats = ensureCategoryArray(p?.category);
                                if (cats.includes('family')) familyProfit += amount;
                                if (cats.includes('couple')) coupleProfit += amount;
                            });
                        }
                        if (rYear === currentYear.value && rMonth === (currentMonth.value + 1)) {
                            Object.entries(rec.playerStats).forEach(([name, amount]) => {
                                if (calMonthMap[name]) { calMonthMap[name].totalProfit += amount; calMonthMap[name].participateCount += 1; }
                            });
                        }
                    });
                    const calLeaderboard = Object.values(calMonthMap).filter(s => s.participateCount > 0).sort((a, b) => b.totalProfit - a.totalProfit);
                    return { familyProfit, coupleProfit, calMonthMap, calLeaderboard };
                });

                const filteredMonthlyStats = computed(() => Object.values(stats.value.calMonthMap).filter(s => s.participateCount > 0));

                const leaderboard = computed(() => {
                    const map = {};
                    players.value.forEach(p => map[p.name] = { name: p.name, totalProfit: 0, totalWinnings: 0, totalLosses: 0, participateCount: 0, winCount: 0, totalRounds: 0 });
                    Object.values(records.value).forEach(rec => {
                        Object.entries(rec.playerStats).forEach(([name, val]) => {
                            if (!map[name]) return;
                            map[name].totalProfit += val;
                            map[name].participateCount += 1;
                            map[name].totalRounds += (Number(rec.rounds) || 0);
                            if (val > 0) { map[name].totalWinnings += val; map[name].winCount += 1; }
                            else { map[name].totalLosses += val; }
                        });
                    });
                    return Object.values(map).filter(s => s.participateCount > 0).map(s => ({ ...s, winRate: ((s.winCount / s.participateCount) * 100).toFixed(1) })).sort((a, b) => b.totalProfit - a.totalProfit);
                });

                const daysInMonth = computed(() => new Date(currentYear.value, currentMonth.value + 1, 0).getDate());
                const firstDayOfMonth = computed(() => new Date(currentYear.value, currentMonth.value, 1).getDay());

                const getAnnualProfit = (name) => leaderboard.value.find(l => l.name === name)?.totalProfit || 0;
                const getAnnualWinnings = (name) => leaderboard.value.find(l => l.name === name)?.totalWinnings || 0;
                const getAnnualLosses = (name) => leaderboard.value.find(l => l.name === name)?.totalLosses || 0;
                const getPartCount = (name) => leaderboard.value.find(l => l.name === name)?.participateCount || 0;
                const getTotalRounds = (name) => leaderboard.value.find(l => l.name === name)?.totalRounds || 0;

                const prevMonth = () => { if (currentMonth.value === 0) { currentMonth.value = 11; currentYear.value--; } else { currentMonth.value--; } };
                const nextMonth = () => { if (currentMonth.value === 11) { currentMonth.value = 0; currentYear.value++; } else { currentMonth.value++; } };

                const openRecordModal = (dateStr, forceEdit = false, forceBlank = false) => {
                    const standardKey = normalizeDateString(dateStr);
                    selectedDate.value = standardKey;
                    const existing = records.value[standardKey];
                    isVerified.value = false; passwordInput.value = ''; passwordError.value = false;
                    if (existing && !forceBlank) {
                        formData.value = JSON.parse(JSON.stringify(existing));
                        viewMode.value = forceEdit ? 'edit' : 'preview';
                    } else {
                        const initialStats = {};
                        players.value.forEach(p => initialStats[p.name] = 0);
                        formData.value = { stakes: '30/10', location: '', rounds: '1', playerStats: initialStats };
                        viewMode.value = 'edit';
                    }
                    isModalOpen.value = true;
                };

                const handleDateClick = (day) => openRecordModal(formatDateKey(currentYear.value, currentMonth.value + 1, day), false, false);
                const handleQuickAdd = () => openRecordModal(formatDateKey(new Date().getFullYear(), new Date().getMonth() + 1, new Date().getDate()), true, true);
                const handleEditTabClick = () => { if (viewMode.value !== 'edit') viewMode.value = 'edit'; };

                const checkPassword = () => {
                    if (passwordInput.value === '0302') { isVerified.value = true; passwordError.value = false; passwordInput.value = ''; }
                    else { passwordError.value = true; passwordInput.value = ''; }
                };

                const updateStat = (name, val) => {
                    const isLoss = formData.value.playerStats[name] < 0;
                    formData.value.playerStats[name] = isLoss ? -Math.abs(val) : Math.abs(val);
                };
                const toggleWinLoss = (name, type) => {
                    const val = Math.abs(formData.value.playerStats[name] || 0);
                    formData.value.playerStats[name] = type === 'win' ? val : -val;
                };

                const saveRecord = async () => {
                    cloudStatus.value = 'syncing';
                    try {
                        await setDoc(doc(db, 'artifacts', appId.value, 'public', 'data', 'records', selectedDate.value), formData.value);
                        isModalOpen.value = false;
                        cloudStatus.value = 'connected';
                    } catch (e) { cloudStatus.value = 'disconnected'; }
                };

                const toggleNewPlayerCategory = (val) => {
                    if (newPlayerCategories.value.includes(val)) newPlayerCategories.value = newPlayerCategories.value.filter(c => c !== val);
                    else newPlayerCategories.value.push(val);
                    if (newPlayerCategories.value.length === 0) newPlayerCategories.value = ['other'];
                };

                const addPlayer = async () => {
                    const name = newPlayerName.value.trim();
                    if (!user.value || !name) return;
                    if (!players.value.find(p => p.name === name)) {
                        const updatedList = [...players.value, { name, category: newPlayerCategories.value }];
                        await setDoc(doc(db, 'artifacts', appId.value, 'public', 'data', 'players_metadata', 'players_list'), { list: updatedList });
                    }
                    formData.value.playerStats[name] = 0;
                    newPlayerName.value = '';
                };

                const removePlayerFromRecord = (name) => { delete formData.value.playerStats[name]; };

                const updatePlayerCategory = async (name, catVal) => {
                    const player = players.value.find(p => p.name === name);
                    if (!player) return;
                    let newCats = [...ensureCategoryArray(player.category)];
                    if (newCats.includes(catVal)) newCats = newCats.filter(c => c !== catVal);
                    else newCats.push(catVal);
                    if (newCats.length === 0) newCats = ['other'];
                    const updatedList = players.value.map(p => p.name === name ? { ...p, category: newCats } : p);
                    await setDoc(doc(db, 'artifacts', appId.value, 'public', 'data', 'players_metadata', 'players_list'), { list: updatedList });
                };

                const getPlayerCategories = (name) => ensureCategoryArray(players.value.find(p => p.name === name)?.category);

                const getPlayerHistory = (name) => {
                    const history = [];
                    Object.entries(records.value).forEach(([date, rec]) => {
                        if (rec.playerStats[name] !== undefined) {
                            const rMonth = parseInt(date.split('-')[1]);
                            if (monthFilter.value === 'all' || rMonth === parseInt(monthFilter.value)) {
                                history.push({ date, amount: rec.playerStats[name], location: rec.location, stakes: rec.stakes });
                            }
                        }
                    });
                    return history.reverse();
                };

                const getFilteredProfit = (name) => getPlayerHistory(name).reduce((sum, h) => sum + h.amount, 0);

                const getCoupleStatsForDay = (date) => {
                    const rec = records.value[date], res = {};
                    if (!rec) return res;
                    Object.entries(rec.playerStats).forEach(([n, s]) => {
                        if (ensureCategoryArray(players.value.find(p => n === p.name)?.category).includes('couple')) res[n] = s;
                    });
                    return res;
                };

                const handleManualRefresh = () => { cloudStatus.value = 'syncing'; setTimeout(() => { cloudStatus.value = 'connected'; fetchData(); }, 1000); };

                const downloadImage = () => {
                    html2canvas(document.querySelector('#app'), { backgroundColor: '#f7f6f6', ignoreElements: (el) => el.classList.contains('no-export') })
                    .then(canvas => { const link = document.createElement('a'); link.download = `mahjong-${currentYear.value}-${currentMonth.value+1}.png`; link.href = canvas.toDataURL(); link.click(); });
                };

                watch([activeTab, isModalOpen, detailPlayer], () => { setTimeout(() => lucide.createIcons(), 10); });

                return {
                    appId, activeTab, monthFilter, currentYear, currentMonth, records, players,
                    isModalOpen, viewMode, selectedDate, detailPlayer, isMonthDetailOpen, cloudStatus,
                    formData, homeFilteredPlayers, stats, leaderboard, daysInMonth, firstDayOfMonth,
                    filteredMonthlyStats, cloudStatusText: computed(() => ({'connected':'雲端已同步', 'disconnected':'離線狀態', 'syncing':'正在同步...'}[cloudStatus.value])),
                    newPlayerName, newPlayerCategories, categoryOptions, addPlayer, toggleNewPlayerCategory, updatePlayerCategory, getPlayerCategories, removePlayerFromRecord,
                    prevMonth, nextMonth, handleDateClick, saveRecord, updateStat, toggleWinLoss,
                    getAnnualProfit, getAnnualWinnings, getAnnualLosses, getPartCount, getTotalRounds,
                    getPlayerHistory, getFilteredProfit, getCoupleStatsForDay,
                    handleManualRefresh, handleQuickAdd, downloadImage, formatDateKey,
                    isVerified, passwordInput, passwordError, checkPassword, handleEditTabClick
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
